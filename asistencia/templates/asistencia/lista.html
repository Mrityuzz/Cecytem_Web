<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Lista de Asistencia</title>
    <style>
      table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 15px;
      }
      th,
      td {
        border: 1px solid #666;
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #f2f2f2;
      }
      .error {
        color: red;
        font-weight: bold;
      }
      form {
        margin-bottom: 15px;
      }
    </style>
  </head>
  <body>
    <h1>Lista de Alumnos</h1>

    <!-- Filtro por carrera -->
    <form method="get">
      <label for="carrera">Filtrar por carrera:</label>
      <select name="carrera" id="carrera">
        <option value="">Todas</option>
        <option value="Electr贸nica">Electr贸nica</option>
        <option value="Programaci贸n">Programaci贸n</option>
        <option value="Laboratorista qu铆mico">Laboratorista qu铆mico</option>
        <option value="Procesos de gesti贸n administrativa">
          Procesos de gesti贸n administrativa
        </option>
      </select>
      <button type="submit">Filtrar</button>
    </form>

    <!-- Bot贸n de descarga -->
    <p>
      <a href="{% url 'descargar_excel' %}"> Descargar Excel</a>
    </p>

    {% if error %}
    <p class="error">{{ error }}</p>
    {% endif %}

    <table>
      <thead>
        <tr>
          <th>Alumno</th>
          <th>N煤mero de Control</th>
          <th>Tel茅fono</th>
          <th>Carrera</th>
          <th>Entrada</th>
          <th>Salida</th>
        </tr>
      </thead>
      <tbody>
        <!-- Aqu铆 se llenar谩 din谩micamente -->
      </tbody>
    </table>

    <script>
      async function actualizarTabla() {
        const response = await fetch("{% url 'lista_asistencia_json' %}");
        const data = await response.json();
        const tbody = document.querySelector("table tbody");
        tbody.innerHTML = "";
        data.alumnos.forEach((a) => {
          const fila = `<tr>
            <td>${a.alumno || "-"}</td>
            <td>${a.num_control || "-"}</td>
            <td>${a.telefono || "-"}</td>
            <td>${a.carrera || "-"}</td>
            <td>${a.entrada || "-"}</td>
            <td>${a.salida || "-"}</td>
          </tr>`;
          tbody.innerHTML += fila;
        });
      }

      // Actualiza cada 5 segundos
      setInterval(actualizarTabla, 5000);

      // Carga inicial
      actualizarTabla();
    </script>
  </body>
</html>
